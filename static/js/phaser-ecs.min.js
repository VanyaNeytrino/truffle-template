!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self);var c=b;c=c.Phaser||(c.Phaser={}),c=c.Plugin||(c.Plugin={}),c.ECS=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){function f(a,b){Phaser.Plugin.call(this,a,b),e.game=a}var d=a("./world"),e=new d;Phaser.ECS=e,f.prototype=Object.create(Phaser.Plugin.prototype),f.prototype.constructor=f,b.exports=f,f.prototype.init=function(){},f.prototype.update=function(){e.update(this.game.time.physicsElapsed)},f.prototype.destroy=function(){Phaser.Plugin.prototype.destroy.apply(this,arguments)}},{"./world":12}],2:[function(a,b,c){function d(a){for(var b=this._length=Math.ceil(a/32),c=this._words=new Array(b);b--;)c[b]=0}d.prototype.set=function(a,b){var c=a/32|0,d=a-32*c;b?this._words[c]|=1<<d:this._words[c]&=~(1<<d)},d.prototype.get=function(a){var b=a/32|0,c=a-32*b;return!!(this._words[b]&1<<c)},d.prototype.reset=function(){for(var a=this._words,b=this._length;b--;)a[b]=0},d.prototype.contains=function(a){var b=this._words,c=this._length;if(c!=a._length)return!1;for(;c--;)if((b[c]&a._words[c])!=a._words[c])return!1;return!0},b.exports=d},{}],3:[function(a,b,c){function g(a,b){this._id=b,this._world=a,this._alive=!0,this._waitingForRefresh=!1,this._waitingForRemoval=!1,this._componentMask=d.MAX_COMPONENTS<=32?new f:new e(d.MAX_COMPONENTS),this._groupMask=d.MAX_GROUPS<=32?new f:new e(d.MAX_GROUPS),this._systemMask=d.MAX_SYSTEMS<=32?new f:new e(d.MAX_SYSTEMS)}var d=a("./global"),e=a("./bit_set"),f=a("./fast_bit_set");g.prototype.get=function(b){return this._world._getComponent(this,b)},g.prototype.add=function(b,c){this._world._addComponent(this,b,c)},g.prototype.remove=function(b){this._world._removeComponent(this,b)},g.prototype.clear=function(){this._world._removeComponents(this)},g.prototype.kill=function(){this._world.kill(this)},Object.defineProperty(g.prototype,"id",{get:function(){return this._id}}),Object.defineProperty(g.prototype,"alive",{get:function(){return this._alive}}),b.exports=g},{"./bit_set":2,"./fast_bit_set":4,"./global":5}],4:[function(a,b,c){function d(){this._bits=0}d.prototype.set=function(a,b){b?this._bits|=1<<a:this._bits&=~(1<<a)},d.prototype.get=function(a){return!!(this._bits&1<<a)},d.prototype.reset=function(){this._bits=0},d.prototype.contains=function(a){return(this._bits&a._bits)==a._bits},b.exports=d},{}],5:[function(a,b,c){function d(a){if(a)for(var b in a)a.hasOwnProperty(b)&&(d[b]=a[b])}b.exports=d},{}],6:[function(a,b,c){var d=a("./global");d.MAX_COMPONENTS=32,d.MAX_GROUPS=32,d.MAX_SYSTEMS=32,d.BitSet=a("./bit_set"),d.FastBitSet=a("./fast_bit_set"),d.IteratingSystem=a("./iterating_system"),d.System=a("./system"),d.World=a("./world"),b.exports=d},{"./bit_set":2,"./fast_bit_set":4,"./global":5,"./iterating_system":7,"./system":8,"./world":9}],7:[function(a,b,c){function e(){d.call(this)}var d=a("./system");e.prototype=Object.create(d.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),e.prototype.processEntities=function(a,b){var c=0,d=a.length;for(c=0;c<d;c++)this.process(a[c],b)},e.prototype.process=function(a,b){},b.exports=e},{"./system":8}],8:[function(a,b,c){function g(){this._componentMask=d.MAX_COMPONENTS<=32?new f:new e(d.MAX_COMPONENTS),this._entities=[],this._world=null,this.enabled=!0}var d=a("./global"),e=a("./bit_set"),f=a("./fast_bit_set");g.prototype.registerComponent=function(a){this._componentMask.set(a,1)},g.prototype.update=function(a){this.enabled&&(this.onBegin(),this.processEntities(this._entities,a),this.onEnd())},g.prototype.processEntities=function(a,b){},g.prototype.onRegistered=function(){},g.prototype.onBegin=function(){},g.prototype.onEnd=function(){},g.prototype.onAdded=function(a){},g.prototype.onRemoved=function(a){},g.prototype._addEntity=function(a){var b=this._entities;b.indexOf(a)<0&&(b.push(a),this.onAdded(a))},g.prototype._removeEntity=function(a){var b=this._entities,c=b.indexOf(a);c>=0&&(b[c]=b[b.length-1],b.pop(),this.onRemoved(a))},Object.defineProperty(g.prototype,"world",{get:function(){return this._world}}),b.exports=g},{"./bit_set":2,"./fast_bit_set":4,"./global":5}],9:[function(a,b,c){function e(){this._systems=[],this._nextEntityID=0,this._nextGroupId=0,this._groups=[],this._groupIDs={},this._alive=[],this._dead=[],this._removed=[],this._refreshed=[],this._componentBags=[]}var d=a("./entity");e.prototype.registerSystem=function(a){if(this._systems.indexOf(a)>=0)throw"Cannot register a system twice";this._systems.push(a),a._world=this,a.onRegistered()},e.prototype.create=function(){var a;return this._dead.length>0?(a=this._dead.pop(),a._alive=!0):a=new d(this,this._nextEntityID++),this._alive.push(a),a},e.prototype.kill=function(a){a._waitingForRemoval||(a._waitingForRemoval=!0,this._removed.push(a))},e.prototype.refresh=function(a){a._waitingForRefresh||(a._waitingForRefresh=!0,this._refreshed.push(a))},e.prototype.update=function(a){this.loopStart();for(var b=this._systems,c=0,d=b.length;c<d;c++)b[c].update(a)},e.prototype.loopStart=function(){var a;for(a=this._removed.length;a--;)this._removeEntity(this._removed[a]);for(this._removed.length=0,a=this._refreshed.length;a--;)this._refreshEntity(this._refreshed[a]);this._refreshed.length=0},e.prototype.addToGroup=function(a,b){var c,d=this._groupIDs[b];void 0===d?(d=this._groupIDs[b]=this._nextGroupId++,c=this._groups[d]=[]):c=this._groups[d],a._groupMask.get(d)||(a._groupMask.set(d,1),c.push(a))},e.prototype.removeFromGroup=function(a,b){var c=this._groupIDs[b];if(void 0!==c){var d=this._groups[c];a._groupMask.get(c)&&(a._groupMask.set(c,0),d[d.indexOf(a)]=d[d.length-1],d.pop())}},e.prototype.removeFromGroups=function(a){for(var b=this._nextGroupId;b--;)if(a._groupMask.get(b)){var c=this._groups[b];c[c.indexOf(a)]=c[c.length-1],c.pop()}a._groupMask.reset()},e.prototype.getEntitiesByGroup=function(a){var b=this._groupIDs[a];return void 0!==b?this._groups[b]:[]},e.prototype.isInGroup=function(a,b){var c=this._groupIDs[b];return void 0!==c&&a._groupMask.get(c)},e.prototype._refreshEntity=function(a){a._waitingForRefresh=!1;for(var b=this._systems,c=0,d=b.length;c<d;c++){var e=a._systemMask.get(c),f=a._componentMask.contains(b[c]._componentMask);e&&!f?(b[c]._removeEntity(a),a._systemMask.set(c,0)):!e&&f&&(b[c]._addEntity(a),a._systemMask.set(c,1))}},e.prototype._removeEntity=function(a){a._alive&&(a._waitingForRemoval=!1,a._alive=!1,this._alive[this._alive.indexOf(a)]=this._alive[this._alive.length-1],this._alive.pop(),this._dead.push(a),a._componentMask.reset(),this.removeFromGroups(a),this._refreshEntity(a))},e.prototype._getComponent=function(a,b){return a._componentMask.get(b)?this._componentBags[a._id][b]:null},e.prototype._addComponent=function(a,b,c){a._componentMask.set(c,1),this._componentBags[a._id]||(this._componentBags[a._id]=[]),this._componentBags[a._id][c]=b,this.refresh(a)},e.prototype._removeComponent=function(a,b){a._componentMask.set(b,0),this.refresh(a)},e.prototype._removeComponents=function(a){a._componentMask.reset(),this.refresh(a)},b.exports=e},{"./entity":3}],10:[function(a,b,c){"use strict";function e(){d.IteratingSystem.call(this),this.game=Phaser.ECS.game}var d=a("makr");e.prototype=Object.create(d.IteratingSystem.prototype),e.prototype.constructor=e,e.prototype.getComponent=function(a){return Phaser.ECS.getComponent(a)},b.exports=e},{makr:6}],11:[function(a,b,c){var d=b.exports={};d.ComponentRegister=function(){var a=0,b=[],c=[];return{register:function(d){var e=b.indexOf(d);return e<0?(b.push(d),c.push(a++),a-1):c[e]},get:function(a){var d=b.indexOf(a);if(d<0)throw"Unknown type "+a;return c[d]}}}(),d.inherits=function(a,b,c){if(a.prototype=Object.create(b.prototype),a.prototype.constructor=a,c)for(var d in c)c.hasOwnProperty(d)&&(a.prototype[d]=c[d])}},{}],12:[function(a,b,c){function g(){d.World.call(this),this.game=!1,this.componentRegister=f.ComponentRegister,this.System=e}var d=a("makr"),e=a("./system"),f=a("./utils");g.prototype=Object.create(d.World.prototype),g.prototype.constructor=d.World,g.prototype.getComponent=function(a){return this.componentRegister.get(a)},g.prototype.registerComponent=function(a){return this.componentRegister.register(a)},b.exports=g},{"./system":10,"./utils":11,makr:6}]},{},[1])(1)});
